<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 文本检测器 - ONNX WASM</title>
    <!--感谢Gemini老师：我根本不会写前端（笑）-->
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
    <style>
        :root {
            --primary-color: #4a90e2;
            --success-color: #2ecc71;
            --warning-color: #f1c40f;
            --danger-color: #e74c3c;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
        }

        .container {
            width: 90%;
            max-width: 800px;
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            margin: 0;
            color: var(--primary-color);
            font-size: 1.8rem;
        }

        .disclaimer {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 0.5rem;
            line-height: 1.4;
        }

        .additional-disclaimer {
            font-size: 0.8rem;
            color: #999;
            margin-top: 1rem;
            padding: 1rem;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid var(--warning-color);
        }

        .github-link {
            text-align: center;
            margin-top: 1rem;
        }

        .github-link a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
        }

        .github-link a:hover {
            text-decoration: underline;
        }

        textarea {
            width: 100%;
            height: 250px;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            resize: none;
            font-size: 1rem;
            transition: border-color 0.3s;
            box-sizing: border-box;
            outline: none;
        }

        textarea:focus {
            border-color: var(--primary-color);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .stats {
            font-size: 0.9rem;
            color: #666;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
        }

        button:hover {
            opacity: 0.9;
        }

        button:active {
            transform: scale(0.98);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #result-area {
            margin-top: 2rem;
            display: none;
            text-align: center;
        }

        .gauge-container {
            width: 100%;
            height: 24px;
            background: #eee;
            border-radius: 12px;
            overflow: hidden;
            margin: 1rem 0;
        }

        #gauge-fill {
            height: 100%;
            width: 0%;
            transition: width 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background-color: var(--primary-color);
        }

        .score-label {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .verdict {
            margin-top: 0.5rem;
            font-size: 1.1rem;
        }

        .loading-spinner {
            display: none;
            margin-left: 10px;
        }

        #status {
            text-align: center;
            font-size: 0.85rem;
            color: #999;
            margin-top: 0.5rem;
        }

        @media (max-width: 480px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>AI 文本特征检测</h1>
        <p class="disclaimer">
            基于本地模型分析（ONNX WASM 推理）。输入 200 字以上中文效果最佳。
        </p>
        <div class="additional-disclaimer">
            <strong>重要：</strong>
            本工具仅用于辅助检测文本中可能存在的AI生成特征，不作为内容真伪与版权归属的最终判定依据。检测结果受模型算法与输入文本质量、风格等多因素影响，存在误判或漏判的可能。请用户与评审方将结果作为参考信息，结合人工判断与其他证据综合评估，切勿单独以本工具结论作为决定性依据。因将本工具结果用于审查、封禁、降权、仲裁等行为所引发的后果与纠纷，由使用方自行承担；本工具及其提供方不对由此造成的任何直接或间接损失承担责任。使用即表示您已阅读并同意以上条款。
        </div>
        <div class="github-link">
            <a href="https://github.com/huzpsb/aigc_js/" target="_blank">Github</a>
        </div>
    </header>

    <textarea id="inputText" placeholder="在这里粘贴你想要检测的文本..."></textarea>

    <div class="controls">
        <div class="stats">
            当前字数: <span id="charCount">0</span>
        </div>
        <button id="detectBtn" onclick="handleDetect()" disabled>
            加载模型中...
            <span id="loading" class="loading-spinner">...</span>
        </button>
    </div>
    <div id="status">正在加载 ONNX 模型...</div>

    <div id="result-area">
        <div class="score-label">人类创作概率: <span id="scoreText">0%</span></div>
        <div class="gauge-container">
            <div id="gauge-fill"></div>
        </div>
        <div id="verdictText" class="verdict"></div>
    </div>
</div>

<script>
    const textarea = document.getElementById('inputText');
    const charCount = document.getElementById('charCount');
    const resultArea = document.getElementById('result-area');
    const gaugeFill = document.getElementById('gauge-fill');
    const scoreText = document.getElementById('scoreText');
    const verdictText = document.getElementById('verdictText');
    const detectBtn = document.getElementById('detectBtn');
    const statusEl = document.getElementById('status');

    textarea.addEventListener('input', () => {
        charCount.innerText = textarea.value.length;
    });

    // Tokenizer
    const TOKENS = "的一在是中用机网为和不了国这能上业年时大高动有人电以市出成场发数新元于全家户手对价行商下多将度公本可来如分通更者作入信到现务内合个美实与方性过面体视品其生计点化无会持而产式日开后万同资联支理等平重量提仅力们最比经自光外据地前长但设系技相已示件定从正我也小器进台还心影费月达速司部模应主线级接推或像报代工频超间统传广期并至要表显展金强款专格需位三利门游制关升络之学他头基天此流营摄创得低色当文果亿服加配单购保标术调道销感约率转企目预功投次就收子增运让片优它告型直法移布身及拍端消屏字记反然清事卡些效名球起明热备变交质观管值供风即音海放引微战互科都存特规置息焦容态首先好股未处准测向版领着京乐第深整景索戏采总区非轻民英北核口看程使包完站求立意续安权受注售称种步软建解活被回源选图指便导百键常快节寸物说团则论华所原验控易带员智集东情星打近里议结想双证样局确精客素尼争竞今具评镜码张问空因社际水界尔析案限话远友势题额适牌付播媒扩板该试士照你每环认号任算足盖略份别随独融域亮王周只盘博例宝黑讯政列类亚响两免载巨形防普官二买细店构降短笔言录装城真由师斯项造占角复搜去望层组画致满享货拉却研幕苹获谷破背路歌极世触稳击查很终连益声爱尚知兴取迅松简航参硬虽马白爆输括监覆办十搭没佳压浪克书助富巴划少许诺再均换境透露康失卖操决始厂云底策考玩充倍济属老银何护季链共气追象范举条脑典山么见彩激维千滑那突编南套几根难众避往李启潮院财携做切庭四神辑命协积补甚教池承给幅西改断闻访眼早仍边语淘围各阿初惠半队娱车较段拥亲责历险警诉州负写火太借读择志识密宽离送红群似演越览革室史宣土另才波省欧审腾芯依储临薄零杀严请蓝库曾盛旅待必料隐惊票假尽块绝拟艺暴疑促军罗究瞬吸批延余且奥女义飞花担落除奇晶虚米丝育酷走按丰德顶峰秒辨抢剧街翻己迎继黄兼职尺询钱五挑够旗架损施登村退止减缺润留捕畅订渠烈页浏馈欢抖危固堪跃聚什差托针私律晰涨夜痛潜府觉缩朋温灵摩刻雅阳令赛裁印圈贴否尤般累钟纳冲材洲塑帮折液距纷捉锁净邮把盟荐曝吧擎某房纯趣喜紧校又味劲江射修谈铁青纪居招币福坛龙驱盈若掌凭排港介念刚呼虎靠伴跟健著估遇签涉胜野毒耐故噪础灯阅授账闪散检委错异巧震席征宏治况林伙听干粉衡咨儿习她顾障厚停春卫握石执苏病判跌释思忧档轮希副陆详害园杂庆顺永逐威侵序耗闭坚截阵醒族董右孩班鲜梦绩戴锐趋缓须跨沉阶食左晚医住厅赠归拨餐含盗圳册赖弹农乎捷箱探霸候刘愿泛攻央座洁秀派久善洗措陈附雷奖迷槛丽赞状耳冰漫骗贵熟址概脱静纹午急税舰燃党虑跑香封夏章宁申顿礼框腻古旨讲侧察酒烧署缝曲韩误刷齐良谁守麦血抗找述岁偿摸旧鱼洞泡藏券敏笑颜瑞诈绿径违尘逊秘舒缘织踪飙抓词讨罪魔诚偏赢河崛犯扬暗迹剖药帖壳汇菜炸逆励弱晓献狂冷吁誉仪死末描毫雄油插垄皮陷榜脸养湖湾绍彻拿毛递碑扫夫宇培猛途槽铺仿牙聊遗繁磨汉卓遭昨壁乔饱劳灰映救楼困纸雪渗伟恶训贸贡乏迟败匹武寻亏母赔遍妈卷幻漏答刺禁猫硕魅揭帝兽挂衣您兰扰振乱综滤糊渐雨杨纽脚洋六沙绑暂男磅宜默颖犹呈绕聘惯唐桥迪疗馆荣拖暖孤杆圆凸染涌牛悉九拆袭课契慢扣租倒跳迫木讼艳豆筹嫌莫剑休遥哪汽纠符烟堂硅佛帧鉴逼骨罚纤婚寨返撰锏伯冬忆抱逾鸟睿草旦灾莓筑狐予倾钢颗袋森篇晨忠伤树搞奢妨掉召乡巅锋涵奋八塞恒疲饰稍毕沃迭滥患鸿朗忽奔届芝添媲宾庞唯薪伪束尾艾仓旋恐哈赶坦七闲贝舟弃叫慧颠童宠迁鼠沿拓既伦撑募棚鼓岛混诞衰贯瓶溯植豪竟吃凡桌敌珠翼窗川偶泄杰丁谢碎刃横迈睐唱拒怀坏沟赌冒伊阻垒番诱轨敬泰父贷肤浮浸枚奏曼朝怎叹莱菲穿宙嵌胶敲廉挥玉墙柱赚肯摇盒披允悄埃债谱妙渡涂秋锂刑膜舆舞督杯喷刊恢尝伸寒谓姆吗冠颈填浦阔胁宴恩柔尬尴邀哥牢肉狗俗塔丹孔烦斗斥铝崩辉尖脉叠呢魂屡虹杭阴拼耀慨摆抽刀抵辅催蒂圣瘾剩俱吴绰甲撼驾郭擦删残滚田谨茨碳夺垂裂替碾堆胡睛逻炒彰胆挖坐剂徐姐扎赋船兵岗栏淡勤凯憾捆浙孙宛炫凌鼎钮蒙幸慎诠凑练梁盲井砂吉驻寿洪抑剪窃偷徕耕镇勒沈循辞蜂叶苦辐肖泽诸丢捐夕穷钻津哲溢蔡碰疫澳缴郑厨勃赏句怪鲁弟厦疾罕窝洛辄姿嘉殊饭旺磁昂辩玻稿吐寄绪赵挤撞咖凤蚕勇灭刮垃县圾稀壮拭怒蒸钓谣沫乃冻乘璃拳峻污磊怕努盾堵杜援饮俄践邦劣碁隔玛淀蛋朱萨滞宿匿阱逃漆粒忍轴侣啡涯昏伏亦械淫笨柯梅惕黏亡兆痕麻巩碍裸顽斜症曹氛镁韧欺毁悬恼忙兄腐猎皆姓秽珍骏欲忘岸酿舍鸡摊彦龄斩绘宫脆锅棒奠穴鞋甜欣掘荡鹏蔽瓦炮惨轰虫尊烤弧妇赫猜抛矿腰铸辆怨奶滩菌敦闹楚瞄悲湿渲莞裕瓜唤扇琴墨隆煌侈紫浅侦庄床敢旬熊袖籍弈芒暑矩坑纵疯拔押缆君诊愤柜皇泥谋恰惑驰睡蓄窄羊攀鸣橡铃夹赴滴浓颇侠卧猪扭歉芬旁堡诗掩兑寥氧梯畸靡卸弥恋肩炉瞩废佐抄欠铭愈帷脏蚀懂捧伍岩佣坡帆拦柳粗履译御斤屋昆啊涛枪眩扶剥辈琐厌歧甘帽巡坞牲豫衔徒鲍鬼割捡奈佩弯衍厘妆牺宅桑酬匀渴胀傻蜜柄腕钥亟吹祖傲卢雾挡矛靓汰锦悦洽爽秦乌曙孵陪宗彭浩讳掀桶翔仔瞻慌牵邓蛮幽潘艰雇毅粘骚酸尸筒仙汤澄遵斌巢凉婴悍倦砌荷瘦纱貌拜凰霜肥锡擅削摔罩仁侃挫饼晒霍撤";
    function getTokens(text) {
        const ids = [];
        for (let i = 0; i < text.length; i++) {
            const c = text[i];
            if (c >= "一" && c <= "龟") {
                const idx = TOKENS.indexOf(c);
                ids.push(idx === -1 ? 0 : idx + 1);
            }
        }
        return ids;
    }

    // Load model
    let session = null;
    async function init() {
        try {
            session = await ort.InferenceSession.create('model.onnx', {
                executionProviders: ['wasm']
            });
            detectBtn.disabled = false;
            detectBtn.textContent = '开始分析';
            statusEl.textContent = '模型已就绪';
            setTimeout(() => statusEl.style.display = 'none', 1500);
        } catch (e) {
            statusEl.textContent = '模型加载失败: ' + e.message;
        }
    }
    init();

    async function handleDetect() {
        const text = textarea.value.trim();
        if (!text) { alert("请输入一些文本再进行分析"); return; }
        if (!session) { alert("模型未就绪"); return; }

        const tokens = getTokens(text);
        if (tokens.length === 0) { updateUI(0); return; }

        resultArea.style.display = 'block';
        detectBtn.disabled = true;
        detectBtn.textContent = '分析中...';

        try {
            const input = new ort.Tensor('int64', BigInt64Array.from(tokens.map(BigInt)), [1, tokens.length]);
            const results = await session.run({ token_ids: input });
            const score = results.score.data[0];
            updateUI(score);
        } catch (e) {
            alert('推理出错: ' + e.message);
        } finally {
            detectBtn.disabled = false;
            detectBtn.textContent = '开始分析';
        }
    }

    function updateUI(score) {
        const percentage = (score * 100).toFixed(1);
        scoreText.innerText = percentage + "%";
        gaugeFill.style.width = percentage + "%";
        let color, verdict;
        if (score > 0.7) {
            color = "#2ecc71";
            verdict = "✨ 文本表现出强烈的人类书写特征。";
        } else if (score > 0.4) {
            color = "#f1c40f";
            verdict = "🤔 文本特征模棱两可，建议人工复核。";
        } else {
            color = "#e74c3c";
            verdict = "🤖 文本表现出明显的 AI 生成特征。";
        }
        gaugeFill.style.backgroundColor = color;
        verdictText.style.color = color;
        verdictText.innerText = verdict;
        resultArea.scrollIntoView({behavior: 'smooth'});
    }
</script>
</body>
</html>
